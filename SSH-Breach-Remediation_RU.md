# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π –≤–∑–ª–æ–º–∞ SSH

## üö® –û–±–∑–æ—Ä –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–π –∏–Ω—Ü–∏–¥–µ–Ω—Ç –≤–∑–ª–æ–º–∞ SSH –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ Debian 10 –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ—à–∞–≥–æ–≤—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π.

### –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∞—Ç–∞–∫–∏
- **–¶–µ–ª—å**: –°–µ—Ä–≤–µ—Ä Debian 10 —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `kodi`
- **–¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞**: –†–æ—É—Ç–µ—Ä MikroTik —Å –ø—Ä–∞–≤–∏–ª–æ–º dst-nat, –æ—Ç–∫—Ä—ã–≤—à–∏–º SSH –ø–æ—Ä—Ç 2223 –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- **–ú–µ—Ç–æ–¥ –∞—Ç–∞–∫–∏**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–±–æ—Ä –ø–∞—Ä–æ–ª–µ–π –±–æ—Ç–Ω–µ—Ç–æ–º
- **–í—Ä–µ–¥–æ–Ω–æ—Å**: –ö—Ä–∏–ø—Ç–æ–º–∞–π–Ω–µ—Ä, –∑–∞–º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥ `kauditd0` (–∏–º—è –ª–µ–≥–∏—Ç–∏–º–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —è–¥—Ä–∞)
- **–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –∞—Ç–∞–∫–∏**: –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ IP –∏–∑ –ù–∏–¥–µ—Ä–ª–∞–Ω–¥–æ–≤, –ì–µ—Ä–º–∞–Ω–∏–∏, –ö–∏—Ç–∞—è, –†–æ—Å—Å–∏–∏
- **–ú–µ—Ö–∞–Ω–∏–∑–º—ã –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–∞**: Cron –∑–∞–¥–∞—á–∏, SSH authorized_keys, —Å–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞

### –ù–∞—á–∞–ª—å–Ω—ã–µ —Å–∏–º–ø—Ç–æ–º—ã
```bash
# –ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å, –ø–æ—Ç—Ä–µ–±–ª—è—é—â–∏–π 400-546% CPU
kodi      3800  546  8.2 2433864 2018232 ?     Ssl  14:14   0:54 kauditd0
```

**–ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏**:
- `kauditd0` –∑–∞–ø—É—â–µ–Ω –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è `kodi` (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ—Ç–æ–∫–æ–º —è–¥—Ä–∞)
- –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU (546% = ~5.5 —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞)
- –ü—Ä–æ—Ü–µ—Å—Å—ã `edac0` —Ç–∞–∫–∂–µ –∑–∞–ø—É—â–µ–Ω—ã –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º `kodi`

---

## üîç –ü–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è kodi
sudo ps aux | grep kodi

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU
top -bn1 | head -20
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ SSH –≤—Ö–æ–¥–æ–≤
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É—Å–ø–µ—à–Ω—ã–µ –≤—Ö–æ–¥—ã
sudo grep "Accepted password" /var/log/auth.log | grep kodi | tail -30

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–µ—É–¥–∞—á–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ –≤—Ö–æ–¥–∞
sudo grep "Failed password" /var/log/auth.log | grep kodi | tail -20

# –ò—Å—Ç–æ—Ä–∏—è –≤—Ö–æ–¥–æ–≤
sudo last -20
```

### 3. –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```bash
# –ù–∞–π—Ç–∏ –Ω–µ–¥–∞–≤–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ kodi
sudo find /home/kodi -type f -mtime -7 -ls

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∫—Ä—ã—Ç—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo ls -laR /home/kodi/
```

**–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–∞**: `/home/kodi/.configrc7/`

### 4. –ò–∑—É—á–µ–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –≤—Ä–µ–¥–æ–Ω–æ—Å–∞
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo ls -la /home/kodi/.configrc7/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH –∫–ª—é—á–∏, –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ –∞—Ç–∞–∫—É—é—â–∏–º–∏
sudo cat /home/kodi/.ssh/authorized_keys

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ö–∞–Ω–∏–∑–º –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–∞ —á–µ—Ä–µ–∑ cron
sudo cat /home/kodi/.configrc7/cron.d
sudo crontab -u kodi -l
```

---

## üõë –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –≤ –æ—Ç–≤–µ—Ç –Ω–∞ –∞—Ç–∞–∫—É

### 1. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ SSH —Å–µ—Ä–≤–∏—Å–∞ (—ç–∫—Å—Ç—Ä–µ–Ω–Ω–æ)
```bash
# –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å SSH
sudo systemctl stop sshd

# –ò–õ–ò –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å SSH –ø–æ—Ä—Ç —á–µ—Ä–µ–∑ iptables
sudo iptables -A INPUT -p tcp --dport 22 -j DROP
sudo iptables-save
```

### 2. –£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
# –£–±–∏—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å
sudo kill -9 3800  # PID —Ñ–µ–π–∫–æ–≤–æ–≥–æ kauditd0

# –£–±–∏—Ç—å –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è kodi
sudo pkill -9 -u kodi

# –£–±–∏—Ç—å –ø–æ –∏–º–µ–Ω–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞
sudo killall -9 kauditd0
sudo killall -9 edac0
sudo killall -9 kswapd00
```

### 3. –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
```bash
# –£–¥–∞–ª–∏—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å –≤—Ä–µ–¥–æ–Ω–æ—Å–æ–º
sudo rm -rf /home/kodi/.configrc7/

# –£–¥–∞–ª–∏—Ç—å SSH –∫–ª—é—á–∏ –∞—Ç–∞–∫—É—é—â–∏—Ö
sudo rm -f /home/kodi/.ssh/authorized_keys
sudo rm -rf /home/kodi/.ssh/

# –£–¥–∞–ª–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –≤—Ä–µ–¥–æ–Ω–æ—Å–æ–º
sudo rm -f /home/kodi/cert*.pem
```

### 4. –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –ø–æ—Å—Ç–æ—è–Ω—Å—Ç–≤–∞
```bash
# –£–¥–∞–ª–∏—Ç—å cron –∑–∞–¥–∞—á–∏
sudo crontab -r -u kodi

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å –∏–∑ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ cron
sudo cat /etc/crontab
sudo ls -la /etc/cron.d/
sudo ls -la /etc/cron.hourly/
sudo ls -la /etc/cron.daily/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å systemd —Å–µ—Ä–≤–∏—Å—ã
sudo systemctl list-units --all | grep kodi
sudo find /etc/systemd -name "*kodi*"
sudo find /home/kodi/.config/systemd -type f 2>/dev/null
```

### 5. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —É—á–µ—Ç–Ω–æ–π –∑–∞–ø–∏—Å–∏
```bash
# –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è kodi
sudo passwd -l kodi

# –ò–∑–º–µ–Ω–∏—Ç—å shell –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –≤—Ö–æ–¥–∞
sudo usermod -s /sbin/nologin kodi

# –ó–∞–ø—Ä–µ—Ç–∏—Ç—å SSH –¥–æ—Å—Ç—É–ø –≤ sshd_config
echo "DenyUsers kodi" | sudo tee -a /etc/ssh/sshd_config
sudo systemctl restart sshd
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å —Ä–æ—É—Ç–µ—Ä–∞ (MikroTik)

### –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–æ–≥–æ dst-nat –ø—Ä–∞–≤–∏–ª–∞

#### –ß–µ—Ä–µ–∑ CLI:
```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ MikroTik
ssh admin@ip-—Ä–æ—É—Ç–µ—Ä–∞

# –°–ø–∏—Å–æ–∫ NAT –ø—Ä–∞–≤–∏–ª
/ip firewall nat print

# –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω–æ–µ dst-nat –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è SSH
/ip firewall nat remove [–Ω–æ–º–µ—Ä]
```

#### –ß–µ—Ä–µ–∑ WinBox:
1. –û—Ç–∫—Ä—ã—Ç—å WinBox –∏ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Ä–æ—É—Ç–µ—Ä—É
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ **IP ‚Üí Firewall ‚Üí NAT**
3. –ù–∞–π—Ç–∏ –ø—Ä–∞–≤–∏–ª–æ —Å `dst-port=22`
4. **–£–¥–∞–ª–∏—Ç—å** —ç—Ç–æ –ø—Ä–∞–≤–∏–ª–æ

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç SSH brute-force
```bash
# –ó–∞—â–∏—Ç–∞ MikroTik –æ—Ç SSH brute-force
/ip firewall filter
add chain=input protocol=tcp dst-port=22 src-address-list=ssh_blacklist action=drop comment="–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ IP –∏–∑ —á–µ—Ä–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞ SSH"
add chain=input protocol=tcp dst-port=22 connection-state=new src-address-list=ssh_stage3 action=add-src-to-address-list address-list=ssh_blacklist address-list-timeout=1w comment="–≠—Ç–∞–ø 3: –ß–µ—Ä–Ω—ã–π —Å–ø–∏—Å–æ–∫"
add chain=input protocol=tcp dst-port=22 connection-state=new src-address-list=ssh_stage2 action=add-src-to-address-list address-list=ssh_stage3 address-list-timeout=1m comment="–≠—Ç–∞–ø 2"
add chain=input protocol=tcp dst-port=22 connection-state=new src-address-list=ssh_stage1 action=add-src-to-address-list address-list=ssh_stage2 address-list-timeout=1m comment="–≠—Ç–∞–ø 1"
add chain=input protocol=tcp dst-port=22 connection-state=new action=add-src-to-address-list address-list=ssh_stage1 address-list-timeout=1m comment="–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π"
```

---

## üîê –£—Å–∏–ª–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ SSH —Å–µ—Ä–≤–µ—Ä–∞

### 1. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–æ–ª—é (—Ç–æ–ª—å–∫–æ –∫–ª—é—á–∏)
```bash
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å SSH –∫–æ–Ω—Ñ–∏–≥
sudo nano /etc/ssh/sshd_config
```

–î–æ–±–∞–≤–∏—Ç—å/–∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç–∏ —Å—Ç—Ä–æ–∫–∏:
```
PasswordAuthentication no
PermitRootLogin no
PubkeyAuthentication yes
AllowUsers –≤–∞—à_–∞–¥–º–∏–Ω_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å  # –ù–ï kodi
```

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ SSH –ø–æ—Ä—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```bash
# –í /etc/ssh/sshd_config
Port 22222  # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç
```

### 3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Fail2Ban
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å fail2ban
sudo apt update
sudo apt install fail2ban -y

# –í–∫–ª—é—á–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
sudo systemctl enable fail2ban
sudo systemctl start fail2ban

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo fail2ban-client status sshd
```

### 4. –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ SSH —Å–µ—Ä–≤–∏—Å–∞
```bash
sudo systemctl restart sshd
```

---

## üî¨ –ì–ª—É–±–æ–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–ø—É—â–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
# –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
ps aux | grep -E "kswapd00|kauditd0|edac0|configrc|init01" | grep -v grep

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU
top -bn1 | head -20
htop  # –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```bash
# –ê–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
sudo netstat -tunap | grep ESTABLISHED
sudo ss -tunap | grep ESTABLISHED

# –ü—Ä–æ—Å–ª—É—à–∏–≤–∞–µ–º—ã–µ –ø–æ—Ä—Ç—ã
sudo netstat -tulpn
sudo ss -tulpn
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ Cron –∑–∞–¥–∞—á
```bash
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ crontab
sudo crontab -l
sudo crontab -u kodi -l
sudo crontab -u root -l

# –°–∏—Å—Ç–µ–º–Ω—ã–π cron
sudo cat /etc/crontab
sudo ls -la /etc/cron.d/
sudo cat /var/spool/cron/crontabs/*
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∫—Ä–∏–ø—Ç–æ–≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
```bash
# rc.local (—Å—Ç–∞—Ä—ã–π —Å—Ç–∏–ª—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞)
sudo cat /etc/rc.local

# –§–∞–π–ª—ã –ø—Ä–æ—Ñ–∏–ª—è Bash
sudo cat /home/kodi/.bashrc | tail -20
sudo cat /home/kodi/.profile | tail -20
sudo cat /home/kodi/.bash_profile 2>/dev/null
```

### 5. –ü–æ–∏—Å–∫ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –≤—Ä–µ–¥–æ–Ω–æ—Å–æ–≤
```bash
# –ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
sudo find / -name "*kswapd*" 2>/dev/null
sudo find / -name "*configrc*" 2>/dev/null
sudo find / -name "*kauditd*" 2>/dev/null

# –ü–æ–∏—Å–∫ –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è—Ö
sudo find /tmp /var/tmp -type f -user kodi 2>/dev/null

# –ü–æ–∏—Å–∫ –Ω–µ–¥–∞–≤–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
sudo find /home/kodi -type f -mtime -7 -ls
```

### 6. –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–∞–Ω–¥ –∞—Ç–∞–∫—É—é—â–∏—Ö
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é bash —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å —á—Ç–æ –¥–µ–ª–∞–ª–∏ –∞—Ç–∞–∫—É—é—â–∏–µ
sudo cat /home/kodi/.bash_history
sudo cat /root/.bash_history
```

---

## üõ°Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä—É—Ç–∫–∏—Ç–æ–≤

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
sudo apt update
sudo apt install rkhunter chkrootkit debsums -y
```

### –ó–∞–ø—É—Å–∫ —Å–∫–∞–Ω–µ—Ä–æ–≤ —Ä—É—Ç–∫–∏—Ç–æ–≤
```bash
# rkhunter
sudo rkhunter --update
sudo rkhunter --check --sk

# chkrootkit
sudo chkrootkit

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –ø–∞–∫–µ—Ç–æ–≤
sudo debsums -c | head -50
```

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–∏—Å—Ç–∫–∏

### 1. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```bash
ps aux | grep kodi
# –ù–µ –¥–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–Ω–µ—à–Ω–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```bash
sudo netstat -tunap | grep ESTABLISHED
# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –ª–µ–≥–∏—Ç–∏–º–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
```

### 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è CPU
```bash
top -bn1 | head -20
# CPU –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ –Ω–æ—Ä–º–µ (–Ω–µ 400%+)
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ SSH –Ω–µ –æ—Ç–∫—Ä—ã—Ç –∏–∑–≤–Ω–µ
```bash
# –£–∑–Ω–∞—Ç—å –≤–∞—à –ø—É–±–ª–∏—á–Ω—ã–π IP
curl ifconfig.me

# –° –¥—Ä—É–≥–æ–π —Å–µ—Ç–∏ –ø—Ä–æ—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤–∞—à IP
nmap -p 22 –í–ê–®_–ü–£–ë–õ–ò–ß–ù–´–ô_IP
# –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å: closed –∏–ª–∏ filtered (–ù–ï open)
```

### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ Cron —á–∏—Å—Ç
```bash
sudo crontab -l
sudo crontab -u kodi -l  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—É—Å—Ç–æ –∏–ª–∏ –æ—à–∏–±–∫–∞
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ: –ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∏—Å—Ç–µ–º—ã
–ü–æ—Å–ª–µ –≤–∑–ª–æ–º–∞ —Ç–∞–∫–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞, **–µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –±—ã—Ç—å –Ω–∞ 100% —É–≤–µ—Ä–µ–Ω–Ω—ã–º** —á—Ç–æ —Å–∏—Å—Ç–µ–º–∞ —á–∏—Å—Ç–∞ —ç—Ç–æ:

1. **–°–¥–µ–ª–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –≤–∞–∂–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö** (–Ω–µ –∏—Å–ø–æ–ª–Ω—è–µ–º—ã—Ö —Ñ–∞–π–ª–æ–≤)
2. **–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É —Å –Ω—É–ª—è**
3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö** (–¥–æ–∫—É–º–µ–Ω—Ç—ã, –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –∫–æ–Ω—Ñ–∏–≥–∏)
4. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å** –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–µ —Ñ–∞–π–ª—ã, —Å–∫—Ä–∏–ø—Ç—ã –∏–ª–∏ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏ –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏

**–ü–æ—á–µ–º—É?** –ê—Ç–∞–∫—É—é—â–∏–µ –º–æ–≥–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å:
- –†—É—Ç–∫–∏—Ç—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞
- –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –±–∏–Ω–∞—Ä–Ω–∏–∫–∏
- –°–∫—Ä—ã—Ç—ã–µ –±—ç–∫–¥–æ—Ä—ã
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –≤—Ä–µ–¥–æ–Ω–æ—Å—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –Ω–µ –Ω–∞—à–ª–∏

### –ï—Å–ª–∏ –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞
–ö–∞–∫ –º–∏–Ω–∏–º—É–º, –ø—Ä–∏–º–∏—Ç–µ —ç—Ç–∏ –º–µ—Ä—ã –ø—Ä–µ–¥–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç–∏:

1. **–°–º–µ–Ω–∏—Ç–µ –í–°–ï –ø–∞—Ä–æ–ª–∏** –≤ —Å–∏—Å—Ç–µ–º–µ
2. **–ü–µ—Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –≤—Å–µ SSH –∫–ª—é—á–∏**
3. **–¢—â–∞—Ç–µ–ª—å–Ω–æ –º–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å–∏—Å—Ç–µ–º—É** –Ω–µ–¥–µ–ª—è–º–∏
4. **–ó–∞–ø—É—Å–∫–∞–π—Ç–µ —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Ä—É—Ç–∫–∏—Ç—ã**
5. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ª–æ–≥–∏ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ** –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏
6. **–ù–∏–∫–æ–≥–¥–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ –¥–æ–≤–µ—Ä—è–π—Ç–µ —ç—Ç–æ–π —Å–∏—Å—Ç–µ–º–µ** –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

---

## üéØ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è

### 1. –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–π—Ç–µ SSH –Ω–∞–ø—Ä—è–º—É—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ VPN** (WireGuard, OpenVPN, L2TP) –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ SSH bastion/jump —Ö–æ—Å—Ç** –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç–∫—Ä—ã—Ç—å SSH
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ port knocking** –∫–∞–∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ dst-nat** –¥–ª—è –ø—Ä–æ–±—Ä–æ—Å–∞ –ø–æ—Ä—Ç–∞ 22 –∏–∑ WAN

### 2. –£—Å–∏–ª–µ–Ω–∏–µ SSH
```bash
# –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è /etc/ssh/sshd_config
PermitRootLogin no
PasswordAuthentication no  # –¢–æ–ª—å–∫–æ –∫–ª—é—á–∏
PubkeyAuthentication yes
Port 22222  # –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –ø–æ—Ä—Ç
AllowUsers admin_user  # –ë–µ–ª—ã–π —Å–ø–∏—Å–æ–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
MaxAuthTries 3
LoginGraceTime 30
```

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–∏–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **–¢–æ–ª—å–∫–æ SSH –∫–ª—é—á–∏** (4096-–±–∏—Ç RSA –∏–ª–∏ Ed25519)
- **–î–ª–∏–Ω–Ω—ã–µ, —Å–ª—É—á–∞–π–Ω—ã–µ –ø–∞—Ä–æ–ª–∏** –µ—Å–ª–∏ –ø–∞—Ä–æ–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã
- **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** (Google Authenticator)

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
# –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤—Ç–æ—Ä–∂–µ–Ω–∏–π
sudo apt install fail2ban

# Firewall
sudo apt install ufw
sudo ufw enable
sudo ufw allow from –í–ê–®_IP to any port 22

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
sudo apt install logwatch
```

### 5. –†–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
```bash
# –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
sudo rkhunter --check
sudo chkrootkit
sudo debsums -c

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ª–æ–≥–æ–≤
sudo tail -f /var/log/auth.log
sudo grep "Failed password" /var/log/auth.log | tail -50
```

### 6. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è —Å–µ—Ç–∏
- **–û—Ç–¥–µ–ª—å–Ω–∞—è —É–ø—Ä–∞–≤–ª—è—é—â–∞—è —Å–µ—Ç—å** –æ—Ç –ø—É–±–ª–∏—á–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
- **VLAN –∏–∑–æ–ª—è—Ü–∏—è** –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–∏—Å—Ç–µ–º
- **–ü—Ä–∞–≤–∏–ª–∞ firewall** –º–µ–∂–¥—É —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ —Å–µ—Ç–∏

---

## üìù –•—Ä–æ–Ω–æ–ª–æ–≥–∏—è –∞—Ç–∞–∫–∏ (–ø—Ä–∏–º–µ—Ä –∏–∑ –∏–Ω—Ü–∏–¥–µ–Ω—Ç–∞)

```
31 —è–Ω–≤ 01:31:59 - –ü–µ—Ä–≤—ã–π —É—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥ —Å 91.215.85.88 (–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã)
31 —è–Ω–≤ 01:33:46 - –í—Ö–æ–¥ —Å 185.244.183.190 (–ì–µ—Ä–º–∞–Ω–∏—è)
31 —è–Ω–≤ 01:33:52 - –í—Ö–æ–¥ —Å 185.173.39.145 (–ì–µ—Ä–º–∞–Ω–∏—è)
31 —è–Ω–≤ 01:54:54 - –í—Ö–æ–¥ —Å 123.156.230.101 (–ö–∏—Ç–∞–π)
31 —è–Ω–≤ 09:23:42 - –í—Ö–æ–¥ —Å 194.163.178.53 (–†–æ—Å—Å–∏—è)
31 —è–Ω–≤ 14:13:00 - –ó–∞–ø—É—â–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã –≤—Ä–µ–¥–æ–Ω–æ—Å–∞
31 —è–Ω–≤ 14:14:00 - kauditd0 –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç 546% CPU
31 —è–Ω–≤ 14:38:00 - –ú–∞—Å—Å–æ–≤—ã–µ brute-force –ø–æ–ø—ã—Ç–∫–∏ —Å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö IP
```

**–í—Ä–µ–º—è –¥–æ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏**: –ú–µ–Ω–µ–µ 24 —á–∞—Å–æ–≤ –ø–æ—Å–ª–µ –æ—Ç–∫—Ä—ã—Ç–∏—è –ø–æ—Ä—Ç–∞

---

## üîó –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [SSH –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ - Mozilla](https://infosec.mozilla.org/guidelines/openssh)
- [CIS Benchmark –¥–ª—è Debian](https://www.cisecurity.org/benchmark/debian_linux)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è fail2ban](https://www.fail2ban.org/)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è rkhunter](http://rkhunter.sourceforge.net/)
- [–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å MikroTik](https://wiki.mikrotik.com/wiki/Manual:Securing_Your_Router)

---

## üìß –ö–æ–Ω—Ç–∞–∫—Ç—ã –∏ –≤–∫–ª–∞–¥

–ï—Å–ª–∏ –≤—ã —Å—Ç–æ–ª–∫–Ω—É–ª–∏—Å—å —Å –ø–æ—Ö–æ–∂–∏–º –≤–∑–ª–æ–º–æ–º –∏–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —à–∞–≥–∏ –ø–æ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—é –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–Ω–µ—Å–∏—Ç–µ —Å–≤–æ–π –≤–∫–ª–∞–¥!

**–ü–æ–º–Ω–∏—Ç–µ**: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å - —ç—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å, –∞ –Ω–µ –∫–æ–Ω–µ—á–Ω–∞—è —Ü–µ–ª—å. –ë—É–¥—å—Ç–µ –±–¥–∏—Ç–µ–ª—å–Ω—ã!

---

## ‚öñÔ∏è –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —Ü–µ–ª—è—Ö. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–∞ —Å–≤–æ–π —Ä–∏—Å–∫.

**–û—Ç–∫–∞–∑ –æ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏**: –í—Å–µ–≥–¥–∞ –∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å–æ —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç–∞–º–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è production —Å–∏—Å—Ç–µ–º.
